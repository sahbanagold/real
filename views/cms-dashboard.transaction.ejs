<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="SemiColonWeb" />

	<!-- Stylesheets
	============================================= -->
	<link href="http://fonts.googleapis.com/css?family=Poppins:300,400,400italic,600,700|Montserrat:400,700|Merriweather" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="style.css" type="text/css" />
	<link rel="stylesheet" href="css/dark.css" type="text/css" />

	<!-- Media Agency Demo Specific Stylesheet -->
	<link rel="stylesheet" href="demos/app-landing/app-landing.css" type="text/css" />
	<!-- / -->

	<link rel="stylesheet" href="css/font-icons.css" type="text/css" />
	<link rel="stylesheet" href="one-page/css/et-line.css" type="text/css" />
	<link rel="stylesheet" href="css/animate.css" type="text/css" />
	<link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />

	<link rel="stylesheet" href="demos/app-landing/css/fonts.css" type="text/css" />

	<!-- Bootstrap Switch CSS -->
	<link rel="stylesheet" href="css/components/bs-switches.css" type="text/css" />

	<link rel="stylesheet" href="css/responsive.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lt IE 9]>
		<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/6.1.1/sweetalert2.min.css">

		<link rel="stylesheet" href="demos/app-landing/css/colors.css" type="text/css" />
	<!-- Document Title
	============================================= -->

	<title><%= title %></title>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<!-- Header
		============================================= -->

		<header id="header" class="full-header no-sticky">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger"><i class="icon-reorder"></i></div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="/home" class="standard-logo" data-dark-logo="images/logo-super.svg"><img src="images/logo-super.svg" width="200"alt="Superman Logo"></a>
						<a href="/home" class="retina-logo" data-dark-logo="images/logo-super.svg"><img src="images/logo-super.svg" width="200"alt="Superman Logo"></a>
				</div><!-- #logo end -->
					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu">
						<ul>
							<li><a href="#"><div> <%= name%> </div></a>
								<ul>
									<li><a href="#" data-toggle="modal" data-target="#change-profile">  <img id="profilePict" src='<%= profilepict%>'
									 class="" alt=""  width="30" height="30"> Change Profile</a></li>
									<li><a href="/logout">Logout</a>
									</li>
								</ul>
							</li>
						</ul>
					</nav><!-- #primary-menu end -->
				</div>
			</div>
		</header>

		<!-- Content
		============================================= -->
		<section id="content">

			<div class="content-wrap">

				<div class="container clearfix">

					<div class="row clearfix">

						<div class="col-sm-12">
								<h3>Superman Dashboard</h3>
								<ul class="nav nav-tabs nav-justified">
									<li class="active"><a href="/cms-transaction"><i class="icon-note"></i> Transaction</a></li>
									<li class=""><a href="/cms-user"><i class="icon-user4"></i> User</a></li>
									<li class=""><a href="/cms-gudang"><i class="icon-home2"></i> Warehouse</a></li>
									<li class=""><a href="/cms-item"><i class="icon-cube"></i> Item</a></li>
						</ul>
						<br>

							<div class="clear"></div>

							<div class="row clearfix">

								<div class="col-md-12">
									<div class="table-responsive">
				<table class="table table-bordered table-striped">
					<colgroup>
						<col class="col-xs-1">
						<col class="col-xs-1">
						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

					</colgroup>
					<thead>
					<tr>
						<th>Verification</th>
						<th>Created At <br>
						<span style="font-size:12px">MM/DD/YYYY</span></th>
						<th>Warehouse Name</th>
						<th>Transfer Request</th>
						<th>Type</th>
						<th>Recipient</th>
						<th>Bank</th>
						<th>Notes</th>
						<th>Status</th>
						<th>Action</th>
					</tr>
					</thead>
					<tbody id="list-transaction">

					</tbody>
				</table>
				</div>



								</div>

							</div>

						</div>

						<div class="line visible-xs-block"></div>



					</div>

				</div>

			</div>

		</section><!-- #content end -->

		<div id="modaldetail" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-body">
					<div class="modal-content">
						<div class="modal-header" id="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title" id="myModalLabel">Details Transaciton</h4>
						</div>

					</div>
				</div>
			</div>
		</div>

		<footer id="footer" style="background-color: #FFF;">

			<div class="container">

				<!-- Footer Widgets
				============================================= -->
				<div class="footer-widgets-wrap clearfix">
					<div class="row clearfix">

						<div class="col-md-5">

							<div class="widget clearfix">
								<div class="row clearfix">

									<div class="">
										Copyrights &copy; 2016 All Rights Reserved by ivangerard.com<br>
										<div class="copyright-links"><a href="#">Terms of Use</a> / <a href="#">Privacy Policy</a></div>
									</div>

								</div>
							</div>

						</div>



					</div>
				</div>

			</div>


		</footer>
	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

	<!-- External JavaScripts
	============================================= -->
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/plugins.js"></script>
	<script src="https://cdn.jsdelivr.net/sweetalert2/6.1.1/sweetalert2.min.js"></script>
	<script type="text/javascript" src="js/components/bs-datatable.js"></script>

	<!-- Footer Scripts
	============================================= -->
	<script type="text/javascript" src="js/functions.js"></script>

	<script>
	$(document).ready(function() {

		listTransaction()



		jQuery( "#tabs-profile" ).on( "tabsactivate", function( event, ui ) {
			jQuery( '.flexslider .slide' ).resize();
		});

	});

	function listTransaction() {
		$.get({
				url: "/api/transactions/",
				success: function(result) {
					for (var k in result.data){


					}
					for(var l =0 ;l<result.transactions.length;l++){
						var status, verf, trtype
						if(result.transactions[l].status == "UnPaid"){
									status =  `<span class="label label-default">Unpaid</span>`
					}else{
						status =  `<span class="label label-success">Paid</span>`
					}
					/// set type

					if(result.transactions[l].transactionsType == "Real"){
								trtype =  `<span class="label label-info">Real</span>`
				}else{
					trtype =  `<span class="label label-warning">Estimation</span>`
				}
					//set verf
					if(result.transactions[l].verification == "UnVerified"){
								verf =  `<span class="label label-default">UnVerified</span>`
				}else{
					verf =  `<span class="label label-success">Verified</span>`
				}
					var date = new Date(result.transactions[l].createdAt)
					var getMonth = date.getMonth()+1
					var getDate = date.getDate()
					var getYear = date.getYear()+1900
					var price = String(result.transactions[l].nominal)
					var priceDel = price.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
						var listdataHTML =
						`
									<tr data-trigger='hover' id=${result.transactions[l]._id} data-placement="top">
										<td >${verf}</td>
										<td>${getMonth+'-'+getDate+'-'+getYear}</td>
										<td><span style="font-size:12px">PIC : ${result.transactions[l].userId.name}</span></td>
										<td><button mark=${result.transactions[l]._id} class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Rp. ${priceDel}</button></td>
										<td>${trtype}</td>
										<td>${result.transactions[l].recipient}</td>
										<td>${result.transactions[l].bank}<br>${result.transactions[l].account}</td>
										<td >${result.transactions[l].notes}</td>
										<td id=${result.transactions[l]._id}label>${status}</td>
										<td><a href="#" data-id='${result.transactions[l]._id}'class="remove update-trx button  button-mini button-rounded button-green"  title="Update this item">Process</a>
										</td>
									</tr>
						`
					$('#list-transaction').prepend(listdataHTML)
					}

											$(".update-trx").click(function() {
													updateTrx($(this).attr('data-id'))
											})
					// $('#list-transaction tr').each(function (e) {
					// 	var idtransaction = $(this).attr('id')
					// 	$(this).bind('hover')
					// 	$(this).popover({
			    //     html : true,
			    //     content: function() {
					// 			var contentdetail = `<div id='hoverdetail'><center><img src='/images/preloader@2x.gif' /></center></div>`
					// 			$.get({
					// 				url: `/api/transactions/${idtransaction}`,
					// 				success: function (result) {
					// 					var contentdetail2 = ""
					// 					for (var i = 0; i < result.data.items.length; i++) {
					// 						var totalprice = (result.data.items[i].totalprice+"").replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
					// 						contentdetail2 += `Item Name: <b>${result.data.items[i].name}</b><br>
					// 						Item Price: <b>${result.data.items[i].price}</b><br>
					// 						Item Quantity: <b>${result.data.items[i].quantity}</b><br>
					// 						Total Price: <b>Rp. ${totalprice}</b><br><br>`
					// 					}
					// 					$('#hoverdetail').html(contentdetail2)
					// 				}
					// 			})
			    //       return contentdetail
			    //     },
			    //     title: function() {
			    //       return 'Transaction detail: ';
			    //     }
			    // })
					// })
					$("button[class*='btn-primary']").each(function () {
						var iddetail = $(this).attr('mark')

						$(this).unbind().on('click',function () {
							var contentdetailreload = `<div id='hoverdetailreload'><center><img src='/images/preloader@2x.gif' /></center></div>`
							$(contentdetailreload).insertAfter('#modal-header')
							$('#modal-body-detail').remove()
							$('#modal-footer').remove()
							$.get({
								url: `/api/transactions/${iddetail}`,
								success: function (result) {
									var rowdetail = ''
									var grandtotal = 0
									for (var i = 0; i < result.data.items.length; i++) {
										var total = result.data.items[i].totalprice
										grandtotal += total
										var totalprice = (total+"").replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
										rowdetail += `<tr>
											<td>
											${result.data.items[i].name}
											</td>
											<td>${result.data.items[i].price}</td>
											<td>${result.data.items[i].quantity}</td>
											<td>Rp. ${totalprice}</td>
										</tr>`
									}
									var detailHTML = `<div class="modal-body" id="modal-body-detail">
										<div class="table-responsive">
																<table class="table table-bordered table-striped">
																  <colgroup>
																	<col class="col-xs-3">
																	<col class="col-xs-1">
																	<col class="col-xs-2">
																	<col class="col-xs-2">
																  </colgroup>
																  <thead>
																	<tr>
																	  <th>Item Name</th>
																	  <th>Item Price</th>
																		<th>Item Quantity</</th>
																		<th>Item Total Price</</th>
																	</tr>
																  </thead>
																  <tbody>
																	${rowdetail}
																  </tbody>

																</table>
															  </div>
									</div>
									<div class="modal-footer" id="modal-footer">
												<h5><b>Total Transaction : Rp. ${(grandtotal+'').replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</b>		</h5>
									</div>`
									$('#hoverdetailreload').remove()
									$(detailHTML).insertAfter('#modal-header')
								}
							})
						})
					})
				}
		})
	}


function updateTrx(id){
	console.log(id)
	swal({
  title: 'Are you sure?',
  text: "This status will change",
  type: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, Status Change!'
}).then(function () {
  swal(
    'Edited!',
    'Your status has been changed.',
    'success'
  ).then(function(){
		$.ajax({
				url: '/api/transactions/'+id,
				type: 'PUT',
				success: function(result) {
			$(`#${id}label`).html('<span class="label label-success">Paid</span>')
				}
		})
	})
})






	}

	</script>

</body>
</html>
