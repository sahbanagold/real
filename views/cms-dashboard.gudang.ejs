<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="SemiColonWeb" />

	<!-- Stylesheets
	============================================= -->
	<link href="http://fonts.googleapis.com/css?family=Poppins:300,400,400italic,600,700|Montserrat:400,700|Merriweather" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="style.css" type="text/css" />
	<link rel="stylesheet" href="css/dark.css" type="text/css" />

	<!-- Media Agency Demo Specific Stylesheet -->
	<link rel="stylesheet" href="demos/app-landing/app-landing.css" type="text/css" />
	<!-- / -->

	<link rel="stylesheet" href="css/font-icons.css" type="text/css" />
	<link rel="stylesheet" href="one-page/css/et-line.css" type="text/css" />
	<link rel="stylesheet" href="css/animate.css" type="text/css" />
	<link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />

	<link rel="stylesheet" href="demos/app-landing/css/fonts.css" type="text/css" />

	<!-- Bootstrap Switch CSS -->
	<link rel="stylesheet" href="css/components/bs-switches.css" type="text/css" />

	<link rel="stylesheet" href="css/responsive.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lt IE 9]>
		<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/6.1.1/sweetalert2.min.css">

		<link rel="stylesheet" href="demos/app-landing/css/colors.css" type="text/css" />
	<!-- Document Title
	============================================= -->

	<title><%= title %></title>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<!-- Header
		============================================= -->

		<header id="header" class="full-header no-sticky">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger"><i class="icon-reorder"></i></div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="/home" class="standard-logo" data-dark-logo="images/logo-super.png"><img src="images/logo-super.svg" width="200"alt="Superman Logo"></a>
						<a href="/home" class="retina-logo" data-dark-logo="images/logo-super.png"><img src="images/logo-super.png" width="200"alt="Superman Logo"></a>
				</div><!-- #logo end -->
					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu">
						<ul>
							<li><a href="#"><div> <%= name%> </div></a>
								<ul>
									<li><a href="#" data-toggle="modal" data-target="#change-profile">  <img id="profilePict" src='<%= profilepict%>'
									 class="" alt=""  width="30" height="30"> Change Profile</a></li>
									<li><a href="/logout">Logout</a>
									</li>
								</ul>
							</li>
						</ul>
					</nav><!-- #primary-menu end -->
				</div>
			</div>
		</header>

		<!-- Content
		============================================= -->
		<section id="content">

			<div class="content-wrap">

				<div class="container clearfix">

					<div class="row clearfix">

						<div class="col-sm-12">
								<h3>Superman Dashboard</h3>
								<ul class="nav nav-tabs nav-justified">
									<li class=""><a href="/cms-transaction"><i class="icon-note"></i> Transaction</a></li>
									<li class=""><a href="/cms-user"><i class="icon-user4"></i> User</a></li>
									<li class="active"><a href="/cms-gudang"><i class="icon-home2"></i> Warehouse</a></li>
									<li class=""><a href="/cms-item"><i class="icon-cube"></i> Item</a></li>
						</ul>
						<br>

							<div class="clear"></div>

						<button class="button button-3d button-rounded button-green fright" data-toggle="modal" data-target="#add-warehouse"><i class="icon-user "></i>Add Warehouse</button>

						<div class="modal fade" id="add-warehouse" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-body">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
											<h4 class="modal-title" id="myModalLabel">Add Warehouse</h4>
										</div>

										<div class="modal-body">
											<form action="/api/warehouse" method="post" class="nobottommargin">
												<div class="col_full">
													<label class="font-body capitalize" for="warehouse-name">Warehouse Name:</label>
													<input type="text" id="warehouse-name" name="name" value="" class="form-control" />
												</div>
												<div class="col_full">
													<label class="font-body capitalize" for="warehouse-location">Location</label>
													<input type="text" id="warehouse-location" name="location" value="" class="form-control" />
												</div>
												<div class="col_full">
													<label class="font-body capitalize" for="warehouse-location">Type</label>
													<input type="text" id="warehouse-type" name="type" value="" class="form-control" />
												</div>


												<div class="col_full" id="userdiv">
												</div>

												<div class="col_full nobottommargin">
													<button class="button button-rounded nomargin" id="warehouse-form-modal-submit" name="warehouse-form-modal-submit" type="submit" value="warehouse">Submit</button>
												</div>
											</form>
										</div>
										<div class="modal-footer">
											<span class"error"></span>
										</div>
									</div>
								</div>
							</div>
						</div>

							<div class="row clearfix">
								<div class="col-md-12">


									<span id="total-gudang">Total Gudang: </span>
									<br>

									<div class="table-responsive">
				<table class="table table-bordered table-striped">
					<colgroup>
						<col class="col-xs-1">
						<col class="col-xs-2">
						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

						<col class="col-xs-1">

					</colgroup>
					<thead>
					<tr>
						<th>Created At
					</th>
						<th>Warehouse Name</th>
						<th>Location</th>
						<th>PIC</th>
						<th>Total Transaction</th>
						<th>Action</th>


					</tr>
					</thead>
					<tbody id="list-gudang">

					</tbody>
				</table>
				</div>
								</div>

							</div>

						</div>

						<div class="line visible-xs-block"></div>



					</div>

				</div>

			</div>

		</section><!-- #content end -->

		<footer id="footer" style="background-color: #FFF;">

			<div class="container">

				<!-- Footer Widgets
				============================================= -->
				<div class="footer-widgets-wrap clearfix">
					<div class="row clearfix">

						<div class="col-md-5">

							<div class="widget clearfix">
								<div class="row clearfix">

									<div class="">
										Copyrights &copy; 2016 All Rights Reserved by ivangerard.com<br>
										<div class="copyright-links"><a href="#">Terms of Use</a> / <a href="#">Privacy Policy</a></div>
									</div>

								</div>
							</div>

						</div>



					</div>
				</div>

			</div>


		</footer>
	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

	<!-- External JavaScripts
	============================================= -->
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/plugins.js"></script>
	<script src="https://cdn.jsdelivr.net/sweetalert2/6.1.1/sweetalert2.min.js"></script>
	<script type="text/javascript" src="js/components/bs-datatable.js"></script>

	<!-- Footer Scripts
	============================================= -->
	<script type="text/javascript" src="js/functions.js"></script>

	<script>
	$(document).ready(function() {
					function setPicOption() {
						$.ajax({
							url: '/api/users',
							type: 'GET',
							success: function(result) {
								if(result.success){
									var userlist = ""
									for (var i = 0; i < result.data.length; i++) {
										userlist += `<option value=${result.data[i]._id} selected="selected">${result.data[i].name}(${result.data[i].userEmail})</option>`
									}
									var useroption = `
									<label class="font-body capitalize" for="warehouse-pic">PIC</label>
									<select id="warehouse-pic" name="userId" value="" class="form-control">
								  ${userlist}
									</select>`
									$('#userdiv').html(useroption)
								}
							}
						})
					}
					setPicOption()
					$("#warehouse-form-modal-submit").unbind().on("click",function(event){

							event.preventDefault()
							$.ajax({
									url: '/api/warehouse',
									type: 'POST',
									data: {
											name: $("#warehouse-name").val(),
											location: $("#warehouse-location").val(),
											type: $("#warehouse-type").val(),
											userId: $("#warehouse-pic").val()
									},
									success: function(result) {
										location.reload();

	// 									var fullname = $("#warehouse-name").val()
	// 									console.log(fullname)
	// 									var email = $("#warehouse-location").val()
	// 									var resultHTML =
	// 									`
	// 									<tr>
	// 										<td>${fullname}</td>
	// 										<td>${email}
	// 										</td>
	// 										<td><a href="#" data-id=''class="remove update-usr button  button-mini button-rounded button-amber"  title="Update this item">Update</a>
	// <a href="#" data-id=''class="remove update-usr button  button-mini button-rounded button-red"  title="Update this item">Delete</a>
	// 										</td>
	// 									</tr>
	// 									`
									}
					})
				})


		listGudang()
		settotaltransactions()
		jQuery( "#tabs-profile" ).on( "tabsactivate", function( event, ui ) {
			jQuery( '.flexslider .slide' ).resize();
		});
	});

	function listGudang() {
		$.get({
				url: "/api/warehouse/",
				success: function(result) {
					console.log()
					var jmlGudang = result.length
						$('#total-gudang').append(jmlGudang)

					for (var k in result){

							var listdataHTML =
							`
										<tr id="${result[k]._id}table">
											<td>${result[k].createdAt}</td>
											<td>${result[k].name}</td>
											<td>${result[k].location}
											</td>
											<td>${result[k].userId.name}
											</td>
											<td id="${result[k]._id}status" class="totaltr">${result[k].isActive}</td>
											<td>
	<a href="#" data-id='${result[k]._id}'class="remove update-gudang button  button-mini button-rounded button-red"  title="Update this item">Delete</a>
											</td>

										</tr>
							`

						$('#list-gudang').prepend(listdataHTML)
						$(".update-gudang").click(function() {
								deleteWarehouse($(this).attr('data-id'))
						})

					}
				}
		})
	}
	function settotaltransactions() {
		$.ajax({
				url: `/api/transactions`,
				type: 'GET',
				success: function(transactions) {
					console.log(transactions, "testny ok");
					if(transactions.success){
						for (var i = 0; i < transactions.data.length; i++) {
							var total = 0

							console.log(transactions.data[i]._id,"5 kali")
							for (var j = 0; j < transactions.data[i].transactions.length; j++) {

								total += transactions.data[i].transactions[j].nominal
							}
							var trrow = `${transactions.data[i].transactions.length} Transactions <br>`
							$(`#${transactions.data[i]._id}status`).html(trrow+"Rp. "+(total+"").replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"))
						}
					} else{
						$(".totaltr").each(function () {
							$(this).html(0)
						})
					}
				}
			})

	}


function deleteWarehouse(id){
	console.log(id)
	swal({
  title: 'Are you sure want to delete?',
  text: "This can't be undo",
  type: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, Status Change!'
}).then(function () {
  swal(
    'Deleted!',
    'Your data has been deleted.',
    'success'
  ).then(function(){
		$.ajax({
				url: '/api/warehouse/'+id,
				type: 'DELETE',
				success: function(result) {
					console.log(result)
			$(`#${id}table`).html('')
				}
		})
	})
})
}

	</script>

</body>
</html>
